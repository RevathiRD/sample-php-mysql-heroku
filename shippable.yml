language: php
build_image: drydock/u14phpall:tip
php: 
  - 5.4
  - 5.5
  - 5.6
  - "7.0"
services:
  - mysql

env:
  global:
    - APP_NAME=mysqlheroku
    - CLEARDB_DATABASE_URL=mysql://shippable@127.0.0.1:3306/test?reconnect=true
    - secure: oyVQnhO6WSuqt+0s86nyY7Mv4AccrK8g3kI6BneYbjgxxG3PaNYXkYM0YWFP+7fsParhUlZoAB6rblDcevGHBe7eBtoz0YuD7wj5j3wD8RSVLlhL5SmNpeZrvj/ZJuO8HJg5msgTfMzlzq/swn+DpLwjdd2ec2CbBHHag43T/Rr9RU20FHqDyM9PWVuDWzoBd04laHW4dZ+yl8HJ9lMb/I4yODc/YvsIdruEdugvYJjCBUKon+umx5uItqApIGi2hmTEicUQeNvxqV4X5cjY49T7byO8dQTd/uoKvBJw+602S2ZL5Ha5IsiguEEYTbUn67R6qc3DKwAXep2IqJcl8g== 

before_install:
  - which heroku || wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh

before_script: 
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - mysql -e 'create database if not exists test;'

script:
  - phpunit --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage test.php

after_success:
  - test -f ~/.ssh/id_rsa.heroku || ssh-keygen -y -f ~/.ssh/id_rsa > ~/.ssh/id_rsa.heroku && heroku keys:add ~/.ssh/id_rsa.heroku
  - git remote -v | grep ^heroku || heroku git:remote --ssh-git --app $APP_NAME
  - git push -f heroku $BRANCH:master
  
  
  
  
